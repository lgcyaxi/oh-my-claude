# v1.4.x Changelog

## v1.4.0 - 2026-02-05

### Added

- **Live Model Switching (Proxy)**: HTTP proxy server that intercepts Claude Code's native API calls for in-conversation model switching
  - Proxy server on port 18910 (configurable) — Claude Code connects via `ANTHROPIC_BASE_URL`
  - Control API on port 18911 (configurable) — health, status, switch, revert endpoints
  - Signal file IPC (`proxy-switch.json`) for zero-overhead coordination between MCP and proxy
  - SSE streaming passthrough using `ReadableStream` — no buffering
  - Auto-revert via request counter + timeout (default: 1 request, 10 min timeout)
  - Graceful fallback to native Claude when provider API key is missing
- **`/omc-switch` Slash Command**: Switch models directly in conversation
  - Shortcut aliases: `ds` (DeepSeek Chat), `ds-r` (DeepSeek Reasoner), `zp` (ZhiPu), `mm` (MiniMax)
  - Supports revert via "switch back" / "revert" in arguments
  - Usage: `/omc-switch ds-r 3` → next 3 requests via DeepSeek Reasoner
- **OAuth Proxy Support**: Proxy works with Claude Code OAuth sessions (no `ANTHROPIC_API_KEY` required)
  - Auto-detects auth mode: `api-key` (traditional) or `oauth` (passthrough)
  - OAuth mode forwards original auth headers (`authorization`, `x-api-key`) as-is to Anthropic
  - CLI `proxy enable` shows detected auth mode
- **Proxy MCP Tools** (3 tools):
  - `switch_model` — Switch next N requests to external provider (DeepSeek, ZhiPu, MiniMax)
  - `switch_status` — Query current proxy switch state
  - `switch_revert` — Immediately revert to native Claude passthrough
- **Proxy CLI Commands**:
  - `oh-my-claude proxy start` — Start proxy daemon
  - `oh-my-claude proxy stop` — Stop proxy daemon
  - `oh-my-claude proxy status` — Show proxy state
  - `oh-my-claude proxy enable` — Enable proxy in config
  - `oh-my-claude proxy disable` — Disable proxy in config
  - `oh-my-claude proxy switch <provider> <model>` — Manual model switch from CLI
- **Proxy StatusLine Segment**: Shows `[→DS/R ×2]` when switched (hidden otherwise)
  - Arrow prefix indicates redirected traffic
  - Provider/model abbreviation + remaining request count
  - Yellow color for attention during switch
  - Added to `standard` and `full` presets
- **`skipInitialRequests` for Proxy Switch**: First N requests after model switch are skipped from counting, compensating for slash command internal API overhead (default: 2)
- **Memory Awareness Hook**: `UserPromptSubmit` hook nudges Claude to use memory proactively
  - Fires on significant user messages when memories exist
  - Injects context: "N memories available. Consider using recall/remember."
  - Agents now recall before work and remember after decisions
- **Memory Integration in Commands**: `/omc-sisyphus` and `/ulw` now include Memory Integration sections
  - Recall relevant memories before planning
  - Remember key decisions and findings after work
- **Session Prompt Logging**: User prompts are now logged to `active-session.jsonl` for richer session context
- **Completion Trigger Detection**: Memory awareness hook detects task completion signals (`commit`, `done`, `finish`, `complete`, `session-end`) and assertively prompts `remember()` calls
- **Agent Capability Awareness**: All agents (Oracle, Analyst, Librarian, Frontend-UI-UX, Document-Writer, Sisyphus) now include capability sections documenting memory tools (`recall`/`remember`) and hot-switch model switching

### Changed

- **Oracle Agent**: Default provider changed from `deepseek` (deepseek-reasoner) to `claude` (claude-sonnet-4.5) for higher-quality reasoning
- Proxy auth supports dual mode: `api-key` and `oauth` (auto-detected)
- Installer now deploys proxy server to `~/.claude/oh-my-claude/`
- StatusLine config schema updated with `proxy` segment (position 9)
- CLI `statusline toggle` command accepts `proxy` segment
- Build system includes `build:proxy` target

### Fixed

- **Proxy CLI Windows Support**: Replaced Unix-only `curl` health checks with cross-platform Node `http` module, replaced `pgrep` process discovery with PID file + platform-specific fallback (`wmic` on Windows, `pgrep` on Unix)
- **Proxy Start on Windows**: Added `shell: true` and `windowsHide: true` spawn options for background daemon on Windows; env variable hint now shows `set` instead of `export`
- **Statusline Missing Segments**: Fixed `loadConfig()` not backfilling new segments (memory, proxy) for existing config files created before these segments were added — Zod filled missing keys with `enabled: false` instead of preset-aware defaults
- **Statusline Config Backfill**: `applyPresetToConfig()` now compares raw file keys against all known segments and applies preset-appropriate defaults for any missing ones, auto-persisting the updated config
